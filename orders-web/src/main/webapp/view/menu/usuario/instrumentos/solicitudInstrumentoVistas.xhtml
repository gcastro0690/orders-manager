<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui" xmlns:f="http://xmlns.jcp.org/jsf/core">

<ui:composition>
	<h:form id="solicitudInstrumentoVistas">
		<div class="ui-g-6 ui-md-6 ui-lg-6">
			<p:dataTable var="solVistas" widgetVar="solVistas" id="vistas" name="vistas" reflow="true" rows="10"
				rowsPerPageTemplate="5,10,15,25,50" rowIndexVar="rowIndex" rowKey="#{solVistas.id}"
				value="#{darVistaSolicitud.vistasSolicitud}" sortBy="#{solVistas.fecha}" sortOrder="DESCENDING" emptyMessage=""
				class="tabla" paginator="true" currentPageReportTemplate="{currentPage} #{msg.de} {totalPages}"
				paginatorPosition="bottom" selectionMode="single" selection="#{darVistaSolicitud.vistaSeleccionada}"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

				<p:ajax event="rowSelect" listener="#{darVistaSolicitud.onRowSelect}"
					update="tabs:solicitudInstrumentoVistas:txtRespuesta" />

				<p:column headerText="#{msg.solicitud_tabla_dv_fecha}">
					<h:outputText value="#{solVistas.fecha.time}">
						<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
					</h:outputText>
				</p:column>

				<p:column headerText="#{msg.solicitud_tabla_dv_usuario}">
					<h:outputText value="#{solVistas.usuarioNombre}" />
				</p:column>
				<p:column headerText="#{msg.solicitud_tabla_dv_vistaresp}">
					<h:outputText value="#{solVistas.tipo}" />
				</p:column>
				<p:column headerText="#{msg.solicitud_tabla_cab_ver}">
					<p:outputPanel rendered="#{solVistas.ruta != null}">
						<ui:include src="/view/template/downloadTemplate.xhtml">
							<ui:param name="form" value="#{false}" />
							<ui:param name="styleClass" value="downloadButtonTable" />
							<ui:param name="file" value="#{solVistas}" />
						</ui:include>
					</p:outputPanel>
				</p:column>
			</p:dataTable>
		</div>
		<div class="ui-g-6 ui-md-6 ui-lg-6">
			<h:panelGroup class=" ui-g-12 ui-md-6 ui-lg-6" id="txtRespuesta" style="height:320px;">
				<p:scrollPanel rendered="#{darVistaSolicitud.vistaSeleccionada != null}" mode="native"
					style="width:500px;height:300px;padding: 12px 15px;">
					<p:outputLabel id="labTxtRespuesta" escape="false" value="#{darVistaSolicitud.vistaSeleccionada.texto}"
						readonly="true" />
				</p:scrollPanel>
			</h:panelGroup>
		</div>

		<div class="ui-g-12 ui-md-12 ui-lg-12">
			<p:commandButton
				value="#{darVistaSolicitud.esIntendencia? msg.solicitud_btn_dv_sar_responder : msg.solicitud_btn_dv_sar_vista}"
				styleClass="boton-redondeado-verde" style="font-size: 12pt;" rendered="#{darVistaSolicitud.puedeDarVista}"
				onclick="PF('dlgDarVista').show();" />
		</div>

		<p:dialog header="#{msg.solicitud_dialog_dar_vista}" widgetVar="dlgDarVista" id="dlgDarVista" modal="true" resizable="false"
			closable="false" closeOnEscape="true" width="700px" height="550px" draggable="false">
			 <p:ajax event="close"  />
			<div class="ui-g-12 ui-md-12 ui-lg-12">
				<p:textEditor id="descVista" height="300" value="#{darVistaSolicitud.vistaNueva.texto}">
					<f:facet name="toolbar">
						<span class="ql-formats">
							<button class="ql-bold" />
							<button class="ql-italic" />
							<button class="ql-underline" />
							<button class="ql-strike" />
						</span>
						<span class="ql-formats"> <select class="ql-size" />
							<button class="ql-blockquote" />
							<button class="ql-clean" />
							<button class="ql-list ql-active" value="ordered" />
							<button class="ql-list" value="bullet" />
							<button class="ql-indent" value="-1" />
							<button class="ql-indent" value="+1" />
						</span>
					</f:facet>
				</p:textEditor>
			</div>
			<div class="ui-g-12 ui-md-12 ui-lg-12">
				<div class="ui-g-6 ui-md-6 ui-lg-6">
					<p:fileUpload fileUploadListener="#{darVistaSolicitud.handleFileUpload}" mode="advanced" dragDropSupport="false"
						multiple="false" auto="true" label="#{msg.btn_subir}" update="fileUploadName"
						rendered="#{!darVistaSolicitud.esIntendencia}" />
				</div>
				<div class="ui-g-6 ui-md-6 ui-lg-6">
					<p:outputLabel value="#{darVistaSolicitud.vistaNueva.nombreArchivo}" id="fileUploadName" />
				</div>

			</div>
			<div class="ui-g-12 ui-md-12 ui-lg-12">
				<p:commandButton value="#{msg.btn_aceptar_mayus}" oncomplete="PF('dlgDarVista').hide();"
					styleClass="boton-redondeado-verde" style="font-size: 12pt;" actionListener="#{darVistaSolicitud.darVista}"
					update=":tabs:solicitudInstrumentoVistas" />

				<p:commandButton value="#{msg.btn_cancelar}" styleClass="boton-redondeado-verde" style="font-size: 12pt;"
					oncomplete="PF('dlgDarVista').hide();" actionListener="#{darVistaSolicitud.cancelFileUpload}" update="dlgDarVista"/>
			</div>

		</p:dialog>
	</h:form>
</ui:composition>
</html>